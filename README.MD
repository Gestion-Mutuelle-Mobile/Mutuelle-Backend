# üìö API Mutuelle Enseignants ENSPY - Documentation Compl√®te

> **Documentation ultra-d√©taill√©e pour le d√©veloppeur frontend**  
> Tout ce qu'il faut savoir pour int√©grer l'API de la Mutuelle des Enseignants ENSPY

---

## üéØ Table des Mati√®res

1. [Vue d'ensemble](#vue-densemble)
2. [Architecture de l'API](#architecture-de-lapi)
3. [Authentification](#authentification)
4. [Endpoints par Module](#endpoints-par-module)
5. [Filtres et Recherche](#filtres-et-recherche)
6. [Mod√®les de Donn√©es](#mod√®les-de-donn√©es)
7. [Gestion des Erreurs](#gestion-des-erreurs)
8. [Exemples d'Utilisation](#exemples-dutilisation)
9. [Cas d'Usage Sp√©cifiques](#cas-dusage-sp√©cifiques)

---

## üåü Vue d'ensemble

L'API de la Mutuelle ENSPY est une API REST compl√®te qui g√®re tous les aspects financiers d'une mutuelle d'enseignants :

- **üí∞ Gestion financi√®re** : √©pargnes, emprunts, remboursements
- **üë• Gestion des membres** : inscriptions, statuts, donn√©es compl√®tes
- **ü§ù Solidarit√©** : paiements de solidarit√©, fonds social
- **üéÅ Assistances** : demandes, validations, paiements
- **üí∏ Renflouements** : calculs automatiques, suivis des paiements
- **üìä Rapports** : statistiques compl√®tes, tableaux de bord

### Base URL
```
http://localhost:8000/api/
```

### Format des R√©ponses
Toutes les r√©ponses sont en JSON avec encodage UTF-8.

---

## üèóÔ∏è Architecture de l'API

### Structure des URLs

```
/api/
‚îú‚îÄ‚îÄ auth/                    # Authentification et utilisateurs
‚îú‚îÄ‚îÄ token/                   # Gestion des tokens JWT
‚îú‚îÄ‚îÄ core/                    # Mod√®les de base (membres, exercices, sessions)
‚îú‚îÄ‚îÄ transactions/            # Toutes les transactions financi√®res
‚îî‚îÄ‚îÄ administration/          # Dashboard et gestion admin
```

### Modules Principaux

| Module | Description | Acc√®s |
|--------|-------------|-------|
| **authentication** | Utilisateurs, profils, auth | Public/Priv√© |
| **core** | Membres, exercices, sessions, config | Public |
| **transactions** | Paiements, emprunts, √©pargnes | Public |
| **administration** | Dashboard admin, rapports | Admin seulement |

---

## üîê Authentification

### Syst√®me d'Auth : JWT (JSON Web Tokens)

#### 1. Obtenir un Token

```http
POST /api/token/
Content-Type: application/json

{
  "email": "admin@enspy.com",
  "password": "motdepasse123"
}
```

**R√©ponse :**
```json
{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

#### 2. Utiliser le Token

```http
GET /api/core/membres/
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
```

#### 3. Rafra√Æchir le Token

```http
POST /api/token/refresh/
Content-Type: application/json

{
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

#### 4. V√©rifier un Token

```http
POST /api/token/verify/
Content-Type: application/json

{
  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

### Permissions par Endpoint

| Type d'Endpoint | Permission | Description |
|------------------|------------|-------------|
| `GET` (lecture) | `AllowAny` | Acc√®s libre √† toutes les donn√©es |
| `POST/PUT/PATCH` donn√©es | `AllowAny` | Cr√©ation/modification libre |
| Dashboard admin | `IsAdministrateur` | Admin seulement |
| Profil utilisateur | `IsOwnerOrAdmin` | Propri√©taire ou admin |

---

## üìã Endpoints par Module

### üîë Authentication

#### Utilisateurs

```http
GET    /api/auth/utilisateurs/           # Liste des utilisateurs (admin)
POST   /api/auth/utilisateurs/           # Cr√©er un utilisateur
GET    /api/auth/utilisateurs/{id}/      # D√©tails d'un utilisateur
PUT    /api/auth/utilisateurs/{id}/      # Modifier un utilisateur
DELETE /api/auth/utilisateurs/{id}/      # Supprimer un utilisateur

# Actions sp√©ciales
GET    /api/auth/utilisateurs/me/        # Mon profil
PATCH  /api/auth/utilisateurs/update_profile/  # Modifier mon profil
```

#### exemple :

```javascript

// 1. Se connecter
const login = async (email, password) => {
  const response = await fetch('/api/token/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });
  
  const { access, refresh } = await response.json();
  
  // 2. R√©cup√©rer les donn√©es utilisateur
  const userResponse = await fetch('/api/auth/utilisateurs/me/', {
    headers: { 'Authorization': `Bearer ${access}` }
  });
  
  const userData = await userResponse.json();
  
  // 3. Stocker tout
  localStorage.setItem('access_token', access);
  localStorage.setItem('refresh_token', refresh);
  localStorage.setItem('user_data', JSON.stringify(userData));
  
  return { access, refresh, user: userData };
};

```


#### Profil et Mot de Passe

```http
GET    /api/auth/profile/                # Mon profil complet
POST   /api/auth/change-password/        # Changer mot de passe
```

**Exemple - Cr√©er un utilisateur :**
```json
POST /api/auth/utilisateurs/
{
  "username": "jean.dupont",
  "email": "jean.dupont@gmail.com",
  "first_name": "Jean",
  "last_name": "Dupont",
  "telephone": "+237690123456",
  "role": "MEMBRE",
  "password": "motdepasse123",
  "password_confirm": "motdepasse123",
  "photo_profil": null
}
```

---

### üè¢ Core (Mod√®les de Base)

#### Configuration de la Mutuelle

```http
GET    /api/core/configurations/         # Liste des configurations
GET    /api/core/configurations/current/ # Configuration actuelle
PUT    /api/core/configurations/{id}/    # Modifier config (admin)
```

**R√©ponse Configuration Actuelle :**
```json
{
  "id": "uuid",
  "montant_inscription": 150000,
  "montant_solidarite": 10000,
  "taux_interet": 3.0,
  "coefficient_emprunt_max": 5,
  "duree_exercice_mois": 12,
  "date_creation": "2024-01-01T00:00:00Z",
  "date_modification": "2024-06-02T21:34:56Z"
}
```

#### Exercices

```http
GET    /api/core/exercices/              # Liste des exercices
POST   /api/core/exercices/              # Cr√©er exercice (admin)
GET    /api/core/exercices/{id}/         # D√©tails exercice
GET    /api/core/exercices/current/      # Exercice en cours
```

**Filtres Exercices :**
- `?nom=2024` - Par nom
- `?statut=EN_COURS` - Par statut
- `?is_current=true` - Exercice en cours
- `?year=2024` - Par ann√©e
- `?has_sessions=true` - Qui ont des sessions

#### Sessions

```http
GET    /api/core/sessions/               # Liste des sessions
POST   /api/core/sessions/               # Cr√©er session (admin)
GET    /api/core/sessions/{id}/          # D√©tails session
GET    /api/core/sessions/current/       # Session en cours
```

**Filtres Sessions :**
- `?nom=janvier` - Par nom
- `?exercice={uuid}` - Par exercice
- `?statut=EN_COURS` - Par statut
- `?has_collation=true` - Avec collation
- `?this_month=true` - Ce mois
- `?date_session_after=2024-01-01` - Apr√®s date

#### Membres (‚≠ê LE PLUS IMPORTANT)

```http
GET    /api/core/membres/                # Liste des membres
POST   /api/core/membres/                # Cr√©er membre
GET    /api/core/membres/{id}/           # D√©tails membre
GET    /api/core/membres/{id}/donnees_completes/  # üî• DONN√âES FINANCI√àRES COMPL√àTES
GET    /api/core/membres/statistiques/   # Stats globales membres
```

**üö® SUPER IMPORTANT - Donn√©es Compl√®tes d'un Membre :**

```json
GET /api/core/membres/{id}/donnees_completes/

{
  "membre_info": {
    "id": "uuid",
    "numero_membre": "ENS-0001",
    "nom_complet": "Jean Dupont",
    "email": "jean@gmail.com",
    "telephone": "+237690123456",
    "photo_profil_url": "http://localhost:8000/media/profiles/photo.jpg",
    "date_inscription": "2024-01-15",
    "statut": "EN_REGLE",
    "en_regle": true
  },
  "inscription": {
    "montant_total_inscription": 150000,
    "montant_paye_inscription": 150000,
    "montant_restant_inscription": 0,
    "inscription_complete": true,
    "pourcentage_inscription": 100
  },
  "solidarite": {
    "montant_solidarite_session_courante": 10000,
    "montant_paye_session_courante": 10000,
    "montant_restant_session_courante": 0,
    "solidarite_session_courante_complete": true,
    "total_solidarite_due": 60000,
    "total_solidarite_payee": 60000,
    "dette_solidarite_cumul": 0,
    "solidarite_a_jour": true
  },
  "epargne": {
    "epargne_base": 500000,
    "retraits_pour_prets": 200000,
    "interets_recus": 25000,
    "retours_remboursements": 0,
    "epargne_totale": 325000,
    "epargne_plus_interets": 325000,
    "montant_interets_separe": 25000
  },
  "emprunt": {
    "a_emprunt_en_cours": true,
    "montant_emprunt_en_cours": 200000,
    "montant_total_a_rembourser": 206000,
    "montant_deja_rembourse": 100000,
    "montant_restant_a_rembourser": 106000,
    "pourcentage_rembourse": 48.54,
    "montant_max_empruntable": 1625000,
    "nombre_emprunts_total": 3
  },
  "renflouement": {
    "total_renflouement_du": 15000,
    "total_renflouement_paye": 10000,
    "solde_renflouement_du": 5000,
    "renflouement_a_jour": false,
    "nombre_renflouements": 2
  },
  "resume_financier": {
    "patrimoine_total": 325000,
    "obligations_totales": 111000,
    "situation_nette": 119000
  }
}
```

**Filtres Membres Ultra-Complets :**
```http
# Filtres de base
?numero_membre=ENS-001
?nom_complet=jean
?email=jean
?statut=EN_REGLE

# Filtres financiers
?is_en_regle=true
?has_emprunts=true
?has_emprunts_en_cours=true
?has_renflouements_dus=true
?inscription_complete=true

# Filtres temporels
?inscrit_this_month=true
?inscrit_this_year=true
?month_inscription=6
?year_inscription=2024
?date_inscription_after=2024-01-01
```

#### Types d'Assistance

```http
GET    /api/core/types-assistance/       # Liste des types
POST   /api/core/types-assistance/       # Cr√©er type (admin)
```

#### Fonds Social

```http
GET    /api/core/fonds-social/           # Historique fonds social
GET    /api/core/fonds-social/current/   # Fonds social actuel
```

**R√©ponse Fonds Social Actuel :**
```json
{
  "id": "uuid",
  "exercice": "uuid",
  "exercice_nom": "Exercice 2024",
  "montant_total": 2500000,
  "mouvements_recents": [
    {
      "type_mouvement": "ENTREE",
      "montant": 10000,
      "description": "Solidarit√© ENS-001 - Session Juin 2024",
      "date_mouvement": "2024-06-02T20:00:00Z"
    }
  ],
  "date_creation": "2024-01-01T00:00:00Z",
  "date_modification": "2024-06-02T21:30:00Z"
}
```

---

### üí∞ Transactions

#### Paiements d'Inscription

```http
GET    /api/transactions/paiements-inscription/     # Liste
POST   /api/transactions/paiements-inscription/     # Cr√©er paiement
GET    /api/transactions/paiements-inscription/{id}/ # D√©tails
```

**Filtres :**
```http
?membre={uuid}
?membre_numero=ENS-001
?membre_nom=jean
?session={uuid}
?montant_min=50000
?montant_max=150000
?today=true
?this_week=true
?this_month=true
?this_year=true
?year=2024
?month=6
```

#### Paiements de Solidarit√©

```http
GET    /api/transactions/paiements-solidarite/      # Liste
POST   /api/transactions/paiements-solidarite/      # Cr√©er paiement
```

**Filtres :**
```http
?membre={uuid}
?session={uuid}
?session_en_cours=true
?this_month=true
```

#### Transactions d'√âpargne

```http
GET    /api/transactions/epargne-transactions/      # Liste
POST   /api/transactions/epargne-transactions/      # Cr√©er transaction
```

**Filtres Sp√©ciaux :**
```http
?type_transaction=DEPOT
?type_depot=true
?type_retrait=true
?type_interet=true
?montant_positif=true
?montant_negatif=true
```

#### Emprunts (‚≠ê TR√àS IMPORTANT)

```http
GET    /api/transactions/emprunts/                  # Liste des emprunts
POST   /api/transactions/emprunts/                  # Cr√©er emprunt
GET    /api/transactions/emprunts/{id}/             # D√©tails emprunt
GET    /api/transactions/emprunts/statistiques/     # Stats emprunts
```

**Filtres Emprunts Ultra-Avanc√©s :**
```http
# Statuts
?statut=EN_COURS
?en_cours=true
?rembourse=true
?en_retard=true

# Montants
?montant_emprunte_min=100000
?montant_emprunte_max=1000000
?montant_total_min=200000
?taux_interet_min=2.5

# Pourcentages de remboursement
?pourcentage_rembourse_min=50
?pourcentage_rembourse_max=80
?presque_rembourse=true     # >80% rembours√©
?peu_rembourse=true         # <20% rembours√©

# Dates
?this_month=true
?this_year=true
?date_emprunt_after=2024-01-01
```

**R√©ponse Statistiques Emprunts :**
```json
GET /api/transactions/emprunts/statistiques/

{
  "nombre_emprunts": {
    "total": 45,
    "en_cours": 12,
    "rembourses": 30,
    "en_retard": 3
  },
  "montants": {
    "total_emprunte": 25000000,
    "total_a_rembourser": 25750000,
    "total_rembourse": 20000000,
    "solde_restant": 5750000
  },
  "pourcentages": {
    "taux_remboursement_global": 77.67
  }
}
```

#### Remboursements

```http
GET    /api/transactions/remboursements/            # Liste
POST   /api/transactions/remboursements/            # Cr√©er remboursement
```

#### Assistances

```http
GET    /api/transactions/assistances/               # Liste
POST   /api/transactions/assistances/               # Demander assistance
PUT    /api/transactions/assistances/{id}/          # Modifier statut
```

**√âtats d'une Assistance :**
- `DEMANDEE` ‚Üí `APPROUVEE` ‚Üí `PAYEE`
- `DEMANDEE` ‚Üí `REJETEE`

#### Renflouements (‚≠ê CRUCIAL)

```http
GET    /api/transactions/renflouements/             # Liste
GET    /api/transactions/renflouements/statistiques/ # Stats renflouements
```

**Filtres Renflouements :**
```http
?type_cause=ASSISTANCE
?type_cause=COLLATION
?cause_assistance=true
?cause_collation=true
?solde=true                 # Sold√©s
?non_solde=true            # Non sold√©s
?partiellement_paye=true   # Partiellement pay√©s
```

**R√©ponse Statistiques Renflouements :**
```json
{
  "nombre_renflouements": {
    "total": 125,
    "soldes": 80,
    "non_soldes": 45
  },
  "montants": {
    "total_du": 1250000,
    "total_paye": 950000,
    "montant_restant": 300000
  },
  "pourcentages": {
    "taux_recouvrement": 76.0,
    "taux_solde": 64.0
  }
}
```

#### Paiements de Renflouement

```http
GET    /api/transactions/paiements-renflouement/    # Liste
POST   /api/transactions/paiements-renflouement/    # Payer renflouement
```

---

### üëë Administration (Admin Seulement)

#### Dashboard Complet

```http
GET    /api/administration/dashboard/dashboard_complet/
```

**üî• R√âPONSE DASHBOARD COMPLET :**
```json
{
  "fonds_social": {
    "montant_total": 2500000,
    "exercice": "Exercice 2024",
    "derniere_modification": "2024-06-02T21:30:00Z"
  },
  "tresor": {
    "cumul_total_epargnes": 15000000,
    "nombre_membres": 120
  },
  "emprunts_en_cours": {
    "nombre": 12,
    "montant_total_attendu": 5750000
  },
  "situation_globale": {
    "liquidites_totales": 17500000,
    "engagements_totaux": 5750000
  },
  "derniers_paiements": {
    "inscriptions": [...],
    "solidarites": [...],
    "remboursements": [...]
  },
  "alertes": [
    {
      "type": "RETARD_RENFLOUEMENT",
      "message": "ENS-025 a 75,000 FCFA de retard",
      "priorite": "HAUTE",
      "membre_id": "uuid"
    }
  ],
  "activite_recente": {
    "nouveaux_membres": 3,
    "nouveaux_emprunts": 1,
    "assistances_demandees": 2,
    "total_paiements": 150000
  },
  "membres_problematiques": [...]
}
```

#### Gestion des Membres

```http
POST   /api/administration/gestion-membres/ajouter_paiement_inscription/
POST   /api/administration/gestion-membres/ajouter_paiement_solidarite/
# Cr√©ation
POST /api/administration/gestion-membres/creer_membre_complet/

# Gestion transactions
POST /api/administration/gestion-membres/ajouter_paiement_inscription/
POST /api/administration/gestion-membres/ajouter_paiement_solidarite/
POST /api/administration/gestion-membres/ajouter_epargne/
POST /api/administration/gestion-membres/creer_emprunt/
POST /api/administration/gestion-membres/ajouter_remboursement/
POST   /api/administration/gestion-membres/ajouter_epargne/
POST   /api/administration/gestion-membres/creer_emprunt/
POST   /api/administration/gestion-membres/ajouter_remboursement/
```

**Exemple - Ajouter Paiement d'Inscription :**
```json
POST /api/administration/gestion-membres/ajouter_paiement_inscription/
{
  "membre_id": "uuid",
  "montant": 75000,
  "notes": "Paiement partiel inscription"
}

// R√©ponse
{
  "message": "Paiement inscription ajout√© avec succ√®s",
  "paiement_id": "uuid",
  "nouveau_statut": "EN_REGLE",
  "total_paye": 150000
}


```
### 5. Gestion Compl√®te des Membres (Admin)

#### Cr√©er un Membre Complet

L'admin peut cr√©er un membre complet (utilisateur + membre + paiement initial optionnel) en une seule op√©ration :

```http
POST /api/administration/gestion-membres/creer_membre_complet/
```

**Corps de la requ√™te :**
```json
{
  "username": "marie.martin",
  "email": "marie.martin@gmail.com", 
  "first_name": "Marie",
  "last_name": "Martin",
  "telephone": "+237691234567",
  "password": "motdepasse123",
  "photo_profil": null,
  "date_inscription": "2024-06-02",
  "montant_inscription_initial": 75000
}
```

**Champs requis :**
- `username` : Nom d'utilisateur unique
- `email` : Email unique
- `first_name` : Pr√©nom
- `last_name` : Nom de famille
- `telephone` : Num√©ro de t√©l√©phone

**Champs optionnels :**
- `password` : Mot de passe (d√©faut: "motdepasse123")
- `photo_profil` : Photo de profil (fichier image)
- `date_inscription` : Date d'inscription (d√©faut: aujourd'hui)
- `montant_inscription_initial` : Paiement d'inscription initial (d√©faut: 0)

**R√©ponse de succ√®s (201) :**
```json
{
  "message": "Membre cr√©√© avec succ√®s",
  "utilisateur_id": "uuid-utilisateur",
  "membre_id": "uuid-membre",
  "numero_membre": "ENS-0025",
  "statut": "NON_EN_REGLE"
}
```

**Logique automatique :**
1. **Cr√©ation utilisateur** avec r√¥le "MEMBRE"
2. **G√©n√©ration automatique** du num√©ro de membre (ENS-XXXX)
3. **Association** √† l'exercice et session en cours
4. **Paiement initial** si montant > 0
5. **Statut automatique** : "EN_REGLE" si paiement >= montant inscription, sinon "NON_EN_REGLE"

**Erreurs possibles :**
```json
// Email d√©j√† utilis√© (400)
{
  "email": ["Un utilisateur avec cet email existe d√©j√†"]
}

// Username d√©j√† utilis√© (400)  
{
  "username": ["Un utilisateur avec ce nom d'utilisateur existe d√©j√†"]
}

// Aucun exercice en cours (400)
{
  "error": "Aucun exercice en cours pour l'inscription"
}

// Aucune session en cours (400)
{
  "error": "Aucune session en cours pour l'inscription"
}
```

#### Exemple d'utilisation JavaScript

```javascript
// Cr√©er un nouveau membre complet
const creerMembreComplet = async (donneesNouveauMembre) => {
  try {
    const response = await fetch('/api/administration/gestion-membres/creer_membre_complet/', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(donneesNouveauMembre)
    });
    
    if (!response.ok) {
      const errors = await response.json();
      
      // Gestion des erreurs de validation
      if (response.status === 400) {
        if (errors.email) {
          throw new Error('Cet email est d√©j√† utilis√©');
        }
        if (errors.username) {
          throw new Error('Ce nom d\'utilisateur est d√©j√† pris');
        }
        if (errors.error) {
          throw new Error(errors.error);
        }
      }
      
      throw new Error('Erreur lors de la cr√©ation du membre');
    }
    
    const resultat = await response.json();
    
    return {
      success: true,
      message: resultat.message,
      membre: {
        id: resultat.membre_id,
        numero: resultat.numero_membre,
        statut: resultat.statut
      }
    };
    
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
};

// Exemple d'usage
const nouveauMembre = {
  username: 'jean.doe',
  email: 'jean.doe@gmail.com',
  first_name: 'Jean',
  last_name: 'Doe',
  telephone: '+237690987654',
  password: 'motdepasse456',
  montant_inscription_initial: 100000
};

const resultat = await creerMembreComplet(nouveauMembre);

if (resultat.success) {
  console.log(`Membre cr√©√©: ${resultat.membre.numero} (${resultat.membre.statut})`);
  // Rafra√Æchir la liste des membres
  await chargerListeMembres();
} else {
  console.error('Erreur:', resultat.error);
  // Afficher l'erreur √† l'utilisateur
  showError(resultat.error);
}
```

#### Formulaire de Cr√©ation (React Native)

```javascript
const FormulaireNouveauMembre = ({ onSuccess, onCancel }) => {
  const [formData, setFormData] = useState({
    username: '',
    email: '',
    first_name: '',
    last_name: '',
    telephone: '',
    password: 'motdepasse123',
    montant_inscription_initial: ''
  });
  
  const [loading, setLoading] = useState(false);
  const [errors, setErrors] = useState({});
  
  const handleSubmit = async () => {
    setLoading(true);
    setErrors({});
    
    try {
      // Validation c√¥t√© client
      const newErrors = {};
      if (!formData.email) newErrors.email = 'Email requis';
      if (!formData.first_name) newErrors.first_name = 'Pr√©nom requis';
      if (!formData.last_name) newErrors.last_name = 'Nom requis';
      if (!formData.telephone) newErrors.telephone = 'T√©l√©phone requis';
      
      if (Object.keys(newErrors).length > 0) {
        setErrors(newErrors);
        setLoading(false);
        return;
      }
      
      // G√©n√©rer username si pas fourni
      if (!formData.username) {
        formData.username = `${formData.first_name.toLowerCase()}.${formData.last_name.toLowerCase()}`;
      }
      
      const resultat = await creerMembreComplet(formData);
      
      if (resultat.success) {
        onSuccess(resultat.membre);
      } else {
        setErrors({ general: resultat.error });
      }
      
    } catch (error) {
      setErrors({ general: 'Erreur de connexion' });
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <View style={styles.form}>
      <Text style={styles.title}>Nouveau Membre</Text>
      
      {errors.general && (
        <Text style={styles.error}>{errors.general}</Text>
      )}
      
      <TextInput
        style={styles.input}
        placeholder="Email *"
        value={formData.email}
        onChangeText={(text) => setFormData({...formData, email: text})}
        keyboardType="email-address"
        autoCapitalize="none"
      />
      {errors.email && <Text style={styles.fieldError}>{errors.email}</Text>}
      
      <TextInput
        style={styles.input}
        placeholder="Pr√©nom *"
        value={formData.first_name}
        onChangeText={(text) => setFormData({...formData, first_name: text})}
      />
      {errors.first_name && <Text style={styles.fieldError}>{errors.first_name}</Text>}
      
      <TextInput
        style={styles.input}
        placeholder="Nom *"
        value={formData.last_name}
        onChangeText={(text) => setFormData({...formData, last_name: text})}
      />
      {errors.last_name && <Text style={styles.fieldError}>{errors.last_name}</Text>}
      
      <TextInput
        style={styles.input}
        placeholder="T√©l√©phone *"
        value={formData.telephone}
        onChangeText={(text) => setFormData({...formData, telephone: text})}
        keyboardType="phone-pad"
      />
      {errors.telephone && <Text style={styles.fieldError}>{errors.telephone}</Text>}
      
      <TextInput
        style={styles.input}
        placeholder="Nom d'utilisateur (optionnel)"
        value={formData.username}
        onChangeText={(text) => setFormData({...formData, username: text})}
        autoCapitalize="none"
      />
      
      <TextInput
        style={styles.input}
        placeholder="Mot de passe (d√©faut: motdepasse123)"
        value={formData.password}
        onChangeText={(text) => setFormData({...formData, password: text})}
        secureTextEntry
      />
      
      <TextInput
        style={styles.input}
        placeholder="Paiement initial (FCFA)"
        value={formData.montant_inscription_initial}
        onChangeText={(text) => setFormData({...formData, montant_inscription_initial: text})}
        keyboardType="numeric"
      />
      
      <View style={styles.buttons}>
        <TouchableOpacity 
          style={[styles.button, styles.cancelButton]} 
          onPress={onCancel}
        >
          <Text style={styles.cancelButtonText}>Annuler</Text>
        </TouchableOpacity>
        
        <TouchableOpacity 
          style={[styles.button, styles.submitButton, loading && styles.disabled]} 
          onPress={handleSubmit}
          disabled={loading}
        >
          <Text style={styles.submitButtonText}>
            {loading ? 'Cr√©ation...' : 'Cr√©er Membre'}
          </Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};
```

#### Workflow Complet de Cr√©ation

```javascript
// 1. Validation et cr√©ation
const processusCreationMembre = async (donnees) => {
  console.log('üöÄ D√©but cr√©ation membre...');
  
  // √âtape 1: Cr√©er le membre
  const resultat = await creerMembreComplet(donnees);
  
  if (!resultat.success) {
    console.error('‚ùå √âchec cr√©ation:', resultat.error);
    return { success: false, error: resultat.error };
  }
  
  console.log('‚úÖ Membre cr√©√©:', resultat.membre.numero);
  
  // √âtape 2: R√©cup√©rer les donn√©es compl√®tes
  const donneesCompletes = await fetch(`/api/core/membres/${resultat.membre.id}/donnees_completes/`, {
    headers: { 'Authorization': `Bearer ${token}` }
  }).then(r => r.json());
  
  // √âtape 3: Notifier les autres admins (optionnel)
  await notifierCreationMembre(resultat.membre);
  
  // √âtape 4: Logger l'action
  console.log(`‚úÖ Nouveau membre ${resultat.membre.numero} cr√©√© par ${currentUser.username}`);
  
  return {
    success: true,
    membre: resultat.membre,
    donneesCompletes: donneesCompletes
  };
};
```

#### Routes Compl√®tes Administration Membres

```http
# üÜï Cr√©ation compl√®te
POST /api/administration/gestion-membres/creer_membre_complet/

# üí∞ Gestion financi√®re  
POST /api/administration/gestion-membres/ajouter_paiement_inscription/
POST /api/administration/gestion-membres/ajouter_paiement_solidarite/
POST /api/administration/gestion-membres/ajouter_epargne/
POST /api/administration/gestion-membres/creer_emprunt/
POST /api/administration/gestion-membres/ajouter_remboursement/
```

**Permissions :** Toutes ces routes n√©cessitent le r√¥le `ADMINISTRATEUR`.

#### Rapports

```http
GET    /api/administration/rapports/rapport_financier_complet/
```

**Param√®tres Rapport :**
```http
?date_debut=2024-01-01
?date_fin=2024-06-30
?exercice_id=uuid
```

---

## üîç Filtres et Recherche

### Syst√®me de Filtres Global

Tous les endpoints supportent :

#### 1. Filtres Django Standard
```http
?field=value                    # √âgalit√© exacte
?field__icontains=value        # Contient (insensible √† la casse)
?field__gte=value              # Sup√©rieur ou √©gal
?field__lte=value              # Inf√©rieur ou √©gal
?field__year=2024              # Ann√©e sp√©cifique
?field__month=6                # Mois sp√©cifique
```

#### 2. Filtres de Plage
```http
?field_min=100&field_max=500   # Entre 100 et 500
?date_after=2024-01-01         # Apr√®s date
?date_before=2024-12-31        # Avant date
```

#### 3. Filtres Bool√©ens
```http
?has_field=true                # A une valeur
?is_active=true                # Champ bool√©en
?this_month=true               # Ce mois
?this_year=true                # Cette ann√©e
```

#### 4. Recherche Textuelle
```http
?search=jean                   # Recherche dans tous les champs d√©finis
```

#### 5. Tri
```http
?ordering=date_creation        # Tri croissant
?ordering=-date_creation       # Tri d√©croissant
?ordering=nom,date_creation    # Tri multiple
```

#### 6. Pagination
```http
?page=2                        # Page 2
?page_size=50                  # 50 √©l√©ments par page
```

### Exemples de Requ√™tes Complexes

```http
# Membres inscrits cette ann√©e, en r√®gle, avec emprunts
GET /api/core/membres/?inscrit_this_year=true&is_en_regle=true&has_emprunts=true

# Emprunts de plus de 500k, rembours√©s √† moins de 30%
GET /api/transactions/emprunts/?montant_emprunte_min=500000&pourcentage_rembourse_max=30

# Paiements de solidarit√© de ce mois pour session en cours
GET /api/transactions/paiements-solidarite/?this_month=true&session_en_cours=true

# Renflouements non sold√©s pour assistances
GET /api/transactions/renflouements/?non_solde=true&cause_assistance=true
```

---

## üìä Mod√®les de Donn√©es

### Utilisateur

```json
{
  "id": "uuid",
  "username": "jean.dupont",
  "email": "jean@gmail.com",
  "first_name": "Jean",
  "last_name": "Dupont",
  "telephone": "+237690123456",
  "role": "MEMBRE|ADMINISTRATEUR",
  "photo_profil": "url",
  "photo_profil_url": "url_complete",
  "nom_complet": "Jean Dupont",
  "is_membre": true,
  "is_administrateur": false,
  "date_creation": "datetime",
  "date_modification": "datetime",
  "is_active": true
}
```

### Membre

```json
{
  "id": "uuid",
  "utilisateur": { /* Utilisateur complet */ },
  "numero_membre": "ENS-0001",
  "date_inscription": "date",
  "statut": "EN_REGLE|NON_EN_REGLE|SUSPENDU",
  "exercice_inscription": "uuid",
  "exercice_inscription_nom": "Exercice 2024",
  "session_inscription": "uuid",
  "session_inscription_nom": "Session Janvier 2024",
  "is_en_regle": true,
  "donnees_financieres": { /* Toutes les donn√©es calcul√©es */ }
}
```

### Emprunt

```json
{
  "id": "uuid",
  "membre": "uuid",
  "membre_info": { /* Info membre */ },
  "montant_emprunte": 500000,
  "taux_interet": 3.0,
  "montant_total_a_rembourser": 515000,
  "montant_rembourse": 250000,
  "montant_restant_a_rembourser": 265000,
  "montant_interets": 15000,
  "pourcentage_rembourse": 48.54,
  "session_emprunt": "uuid",
  "session_nom": "Session Mars 2024",
  "date_emprunt": "datetime",
  "statut": "EN_COURS|REMBOURSE|EN_RETARD",
  "statut_display": "En cours",
  "notes": "string",
  "remboursements_details": [ /* Liste des remboursements */ ]
}
```

### Renflouement

```json
{
  "id": "uuid",
  "membre": "uuid",
  "membre_info": { /* Info membre */ },
  "session": "uuid",
  "session_nom": "Session Juin 2024",
  "montant_du": 15000,
  "montant_paye": 10000,
  "montant_restant": 5000,
  "is_solde": false,
  "pourcentage_paye": 66.67,
  "cause": "Assistance D√©c√®s pour ENS-042",
  "type_cause": "ASSISTANCE|COLLATION|AUTRE",
  "type_cause_display": "Assistance",
  "date_creation": "datetime",
  "paiements_details": [ /* Liste des paiements */ ]
}
```

---

## üö® Gestion des Erreurs

### Codes de Statut HTTP

| Code | Signification | Usage |
|------|---------------|-------|
| `200` | OK | Succ√®s |
| `201` | Created | Cr√©ation r√©ussie |
| `400` | Bad Request | Donn√©es invalides |
| `401` | Unauthorized | Token manquant/invalide |
| `403` | Forbidden | Pas les permissions |
| `404` | Not Found | Ressource introuvable |
| `500` | Server Error | Erreur serveur |

### Format des Erreurs

```json
// Erreur de validation
{
  "field_name": [
    "Ce champ est requis."
  ],
  "montant": [
    "Assurez-vous que cette valeur est sup√©rieure ou √©gale √† 0."
  ]
}

// Erreur g√©n√©rale
{
  "detail": "Token invalide ou expir√©."
}

// Erreur m√©tier
{
  "error": "Vous avez d√©j√† un emprunt en cours"
}
```

## üìù Notes Importantes

### 1. Permissions
- **La plupart des endpoints sont en `AllowAny`** comme sp√©cifi√©
- Seuls les endpoints d'administration n√©cessitent le r√¥le `ADMINISTRATEUR`
- L'authentification JWT est optionnelle pour la lecture

### 2. Calculs Automatiques
- **Tous les calculs financiers sont faits c√¥t√© backend**
- Les donn√©es de renflouement se mettent √† jour automatiquement
- Le fonds social est g√©r√© automatiquement
- Les int√©r√™ts sont redistribut√©s automatiquement

### 3. Performance
- **Utilisation de `select_related` et `prefetch_related`** pour optimiser les requ√™tes
- Pagination automatique sur tous les endpoints
- Filtres index√©s pour de meilleures performances

### 4. Donn√©es en Temps R√©el
- **Le dashboard admin** se met √† jour en temps r√©el
- **Les statistiques** sont calcul√©es √† la demande
- **Les alertes** sont g√©n√©r√©es automatiquement

### 5. Extensibilit√©
- **Filtres ultra-complets** pour toutes les recherches possibles
- **Actions personnalis√©es** sur les ViewSets
- **Serializers avec donn√©es calcul√©es** pour √©viter les appels multiples

---


Cette API vous donne **TOUT** ce qu'il faut pour cr√©er une application mobile compl√®te de gestion de mutuelle ! 

**Points forts :**
- ‚úÖ **Donn√©es calcul√©es automatiquement** - pas de calculs c√¥t√© frontend
- ‚úÖ **Filtres ultra-complets** - recherche sur tout et n'importe quoi
- ‚úÖ **Permissions flexibles** - acc√®s libre selon vos specs
- ‚úÖ **Administration compl√®te** - dashboard avec tout ce qu'il faut
- ‚úÖ **Gestion financi√®re automatique** - fonds social, renflouements, int√©r√™ts
- ‚úÖ **Documentation exhaustive** - tous les d√©tails sont l√† !

**Besoin d'aide ?** Tous les exemples de code sont pr√™ts √† utiliser ! üöÄ

---

**D√©velopp√© avec ‚ù§Ô∏è pour la Mutuelle des Enseignants ENSPY**  
*Date de derni√®re mise √† jour : 2 Juin 2024*